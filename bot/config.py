from datetime import datetime
from logger import logger
import telebot
from environs import Env
from telebot import apihelper, StateMemoryStorage

from middleware import ExceptionHandler

env = Env()
env.read_env()

TOKEN = env.str('TOKEN')
GROUP_ID = env.int('GROUP_ID')
API_WEATHER = env.str('API_WEATHER')
CITY = env.str('CITY')
AUTOWEATHER = env.bool('AUTOWEATHER')
WEATHER_TIME = env.str('WEATHER_TIME')
AUTOSHUTDOWN = env.bool('AUTOSHUTDOWN')
SHUTDOWN_TIMES = env.list('SHUTDOWN_TIMES')
LOGGING_LEVEL = env.str('LOGGING_LEVEL')
START_LESSONS = datetime(2024, 2, 12)

ADMIN_ID = env.int('ADMIN_ID')
admin_mode = True

exception_handler = ExceptionHandler(logger)
state_storage = StateMemoryStorage()

bot = telebot.TeleBot(TOKEN, use_class_middlewares=True, state_storage=state_storage,
                      exception_handler=exception_handler)
apihelper.ENABLE_MIDDLEWARE = True

cabinets_info = {"cabinets": [], "author": '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}

days = {
    0: "–ø–Ω",
    1: "–≤—Ç",
    2: "—Å—Ä",
    3: "—á—Ç",
    4: "–ø—Ç",
    5: "—Å–±",
    "–ø–Ω": 0,
    "–≤—Ç": 1,
    "—Å—Ä": 2,
    "—á—Ç": 3,
    "–ø—Ç": 4,
    "—Å–±": 5,
}

define_week = {
    0: "ü´® –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
    1: "‚òïÔ∏è –í—Ç–æ—Ä–Ω–∏–∫",
    2: "üìé –°—Ä–µ–¥–∞",
    3: "üéß –ß–µ—Ç–≤–µ—Ä–≥",
    4: "üçª –ü—è—Ç–Ω–∏—Ü–∞",
    5: "üõå –°—É–±–±–æ—Ç–∞"
}

define_time = {
    0: "8:00",
    1: "9:35",
    2: "11:10",
    3: "13:00",
    4: "14:35",
    5: "16.10"
}

define_lesson_type = {
    0: "–ª.",
    1: "—Å–µ–º.",
    2: "–ø—Ä.",
    3: "–ª–∞–±.",
    4: "—Å–ø–æ—Ä—Ç.",
    5: "–∫–∞—Ä–¥–∏–æ",
    6: "—Å–∏–ª.",
    7: "–¥–æ–ø",
}

pages = {
    "home":
        {
            0: f"<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞ <em>208itc</em>!</b>"
               f"\n<em>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –±–æ—Ç 208 –≥—Ä—É–ø–ø—ã –§–ö–∏–°–ö–î –ë–ì–£–ö–ò</em>\n",

            1: f"\n<b>‚ÑπÔ∏è–ß—Ç–æ –±–æ—Ç —É–º–µ–µ—Ç?</b>\n"
               f"\n- <em>–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</em>"
               f"\n- <em>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</em>"
               f"\n- <em>–ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏ –ø—Ä–∏—Å—ã–ª–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç—ã</em>"
               f"\n- <em>–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</em>"
               f"\n- <em>–ü—Ä–∏—Å—ã–ª–∞—Ç—å –ø–æ–≥–æ–¥—É —Å —É—Ç—Ä–∞</em>"
               f"\n- <em>–†–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ</em>"
               f"\n- <em>–ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ..</em>\n"

        },

    "help":

        f"‚öôÔ∏è<b><u>–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥</u></b>"
        f"\n\n<blockquote><b>–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</b>\n/schedule –∏–ª–∏ /s</blockquote>"
        f"\n- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç <em>|–Ω–µ–¥–µ–ª—è| |–¥–µ–Ω—å|</em> –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ"
        f"\n- –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏ —Ç–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—é"
        f"\n- –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é"
        f"\n- <b>–ü—Ä–∏–º–µ—Ä:</b> <code>/schedule 12 –ø–Ω</code>"
        f"\n\n<blockquote><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏</b>\n/cabinets –∏–ª–∏ /c –∏–ª–∏ <u>–∫–∞–±</u></blockquote>"
        f"\n- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç <em>|–∫–∞–±–∏–Ω–µ—Ç| |–∫–∞–±–∏–Ω–µ—Ç|</em>.."
        f"\n- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ : 4"
        f"\n- –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–±–∏–Ω–µ—Ç–æ–≤"
        f"\n- <b>–ü—Ä–∏–º–µ—Ä:</b> <code>–∫–∞–± 508 800–∞ 507/800</code>"
        f"\n\n<blockquote><b>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏—è</b>\n/add</blockquote>"
        f"\n- –í—ã–∑–æ–≤–µ—Ç –º–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–Ω—è—Ç–∏–π.."
        f"\n- –î–æ—Å—Ç—É–ø –∏–º–µ—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
        f"\n\n<blockquote><b>–£–¥–∞–ª–∏—Ç—å –∑–∞–Ω—è—Ç–∏—è</b>\n/remove</blockquote>"
        f"\n- –í—ã–∑–æ–≤–µ—Ç –º–µ–Ω—é —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–Ω—è—Ç–∏–π"
        f"\n- –î–æ—Å—Ç—É–ø –∏–º–µ—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
        f"\n\n<blockquote><b>–£–∑–Ω–∞—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</b>\n/teacher –∏–ª–∏ /t</blockquote>"
        f"\n- –í—ã–∑–æ–≤–µ—Ç –º–µ–Ω—é –ø–æ–∏—Å–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è"
        f"\n- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–º–∏–ª–∏ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º"
        f"\n\n<blockquote><b>–ü–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É</b>\n/weather –∏–ª–∏ /w</blockquote>"
        f"\n- –û—Ç–ø—Ä–∞–≤–∏—Ç –ø–æ–≥–æ–¥—É –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –≥–æ—Ä–æ–¥–µ –ú–∏–Ω—Å–∫"
        f"\n\n<blockquote><b>–°–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç</b>\n/random –∏–ª–∏ /r</blockquote>"
        f"\n- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç <em>|—ç–ª–µ–º–µ–Ω—Ç1| |—ç–ª–µ–º–µ–Ω—Ç2|</em>.."
        f"\n- –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–µ—Ä–µ—Ç –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç"
        f"\n- –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥–æ–π–¥–µ—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ–º–∏–Ω–∞—Ä–æ–≤"
        f"\n- <b>–ü—Ä–∏–º–µ—Ä:</b> <code>/random @naitmag @BotFather</code>"
        f"\n\n<blockquote><b>–ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>\n/admin</blockquote>"
        f"\n- –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
        f"\n- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Ö. —á–∞—Å—Ç–∏ –±–æ—Ç–∞",

    "contacts":

        f"üìá<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>\n"

        f"\nüì∑ <i><b>Instagram:</b></i>"
        f"\n- <a href='https://www.instagram.com/itinculture/'>–ö–∞—Ñ–µ–¥—Ä–∞ –ò–¢–ö</a>"
        f"\n- <a href='https://www.instagram.com/208itk'>–ì—Ä—É–ø–ø–∞ 208</a>"
        f"\n\nüë§ <i><b>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</b></i>:"
        f"\n- <a href='https://t.me/naitmag'>–°–æ–∑–¥–∞—Ç–µ–ª—å –±–æ—Ç–∞</a>",

    "admin":

        f"<b><u>üîê –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</u></b>"
        f"\n\n<blockquote><b>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</b>\n/read</blockquote>"
        f"\n- –ó–∞–Ω–æ—Å–∏—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
        f"\n\n<blockquote><b>–û—á–∏—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</b>\n/drop</blockquote>"
        f"\n- –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ"
        f"\n- –ë—É–¥—å—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–≤–µ—Ä–µ–Ω—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π"
        f"\n\n<blockquote><b>–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–∞–≤–∞</b>\n/set</blockquote>"
        f"\n- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–æ–ª—å –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞"
        f"\n- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø —É—á–∞—Å—Ç–Ω–∏–∫—É"
        f"\n\n<blockquote><b>–£–∑–Ω–∞—Ç—å —Ä–æ–ª—å</b>\n/perm</blockquote>"
        f"\n- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞"
        f"\n\n<blockquote><b>–£–∑–Ω–∞—Ç—å ID</b>\n/id</blockquote>"
        f"\n- –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–Ω–∞—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º ID –∞–∫–∫–∞—É–Ω—Ç–∞"
        f"\n- –î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º",

    "roles":

        f"<b>üßôüèº <u>–†–æ–ª–∏</u></b>\n"
        f"\n<b>–†–æ–ª–∏</b> - <i>–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, "
        f"–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –±–æ—Ç–∞.</i>"
        f"\n\n<blockquote><b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä üîê</b></blockquote>"
        f"\n- –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞"
        f"\n\n<blockquote><b>–°—Ç–∞—Ä–æ—Å—Ç–∞ üë®‚Äçüè´</b></blockquote>"
        f"\n- –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –∑–∞–Ω—è—Ç–∏—è"
        f"\n\n<blockquote><b>–†–µ–¥–∞–∫—Ç–æ—Ä üìù</b></blockquote>"
        f"\n- –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –∑–∞–Ω—è—Ç–∏—è"
        f"\n\n<blockquote><b>–£—Ä–æ–≤–µ–Ω—å 3Ô∏è‚É£</b></blockquote>"
        f"\n- <i>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ..</i>"
        f"\n\n<blockquote><b>–û–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫ üë®‚Äçüéì</b></blockquote>"
        f"\n- –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç—ã"
        f"\n\n<blockquote><b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å üë§</b></blockquote>"
        f"\n- –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
        f"\n\n<blockquote><b>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω üö´</b></blockquote>"
        f"\n- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–∏–º –∫–æ–º–∞–Ω–¥–∞–º"
}

roles = {
    -1: "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω üö´",
    0: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å üë§",
    1: "–û–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫ üë®‚Äçüéì",
    2: "–£—Ä–æ–≤–µ–Ω—å 3Ô∏è‚É£",
    3: "–†–µ–¥–∞–∫—Ç–æ—Ä üìù",
    4: "–°—Ç–∞—Ä–æ—Å—Ç–∞ üë®‚Äçüè´",
    5: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä üîê"
}

events = {
    'text':
        {
            "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": (40, "–û–ø—è—Ç—å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫üò´"),
            "—Å—É–±–±–æ—Ç": (40, "–í —Å—É–±–±–æ—Ç—É —Å–ø–∞—Ç—å –Ω–∞–¥–æüò¥"),
            "–±–ª—è—Ç—å": (50, "–ú–∞—Ç—ã —ç—Ç–æ –ø–ª–æ—Ö–æüò≥"),
            "–æ—Ä–ª–æ–≤–∞": (50, "–ö–∞—Ç—è —Ç–æ–øüíÖüèº"),
            "ü§°": (100, "ü§°"),
            "—Å –¥–Ω—ë–º": (100, "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!üéâ"),
            "–∞—Ä–±—É–∑": (50, "–¢–≤–æ–π –ø–∞–ø–∞ –∫–∞—Ä–∞–ø—É–∑üçâ"),
            "—Å—Ç–∞—Ä–æ—Å—Ç–∞": (35, "–°—Ç–∞—Ä–æ—Å—Ç–∞ –∫—Ä—É—Ç–∞—èüòã (–º–µ–Ω—è –∑–∞—Å—Ç–∞–≤–∏–ª–∏ —ç—Ç–æ —Å–∫–∞–∑–∞—Ç—å)")

        },
    'photo':
        (3, ["–ö—Ä–∞—Å–∏–≤–æ–µüòç", "–û—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–æ‚ò∫Ô∏è", "–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ —Ñ–æ—Ç–æü§§"])

}
